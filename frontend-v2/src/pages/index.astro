---
import StoriesGrid from '../components/StoriesGrid.astro';
import Layout from '../layouts/Layout.astro';

import { client } from '../lib/strapi';
import type { Story } from "../types";

const PAGE_SIZE = 20;

const storiesRes = await client.collection('stories').find({
  populate: {
    coverImage: true,
    author: true,
  },
  sort: ['createdAt:desc'],
  pagination: { page: 1, pageSize: PAGE_SIZE },
});

const stories = storiesRes.data as Story[];
const pagination = storiesRes.meta.pagination;
---

<Layout>
	<StoriesGrid
		stories={stories}
		pageSize={PAGE_SIZE}
		pageCount={pagination?.pageCount ?? 0}
	/>
</Layout>
